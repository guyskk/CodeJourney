/*! mplayers 26-06-2014 */
function jsonpGetSongList(a){console.log(a);for(var b=a.data.songList,c=0,d=b.length;d>c;c++)SONGLIST[c]=b[c]}!function(){function a(a){this.target=a,this.status=!1}SONGIDS=[],SONGLIST=[],a.prototype.addItem=function(a,b){this[a]=b},a.prototype.emitplay=function(){var a=this,b=this.play,c=this.audio;b.addEventListener("click",function(){a.status?(a.status=!1,b.title="播放",c.pause()):(a.status=!0,b.title="暂停",c.play())},!1)},a.prototype.adjustVolume=function(){var a=this.volumeDown,b=this.volumeUp,c=this.audio;a.addEventListener("click",function(){c.volume>0&&(c.volume=(c.volume-.1).toFixed(1))},!1),b.addEventListener("click",function(){c.volume<1&&(c.volume=(c.volume+.1).toFixed(1))},!1)},a.prototype.next=function(){var a=this.forward,b=this.audio,c=0;console.log(a),a.addEventListener("click",function(){b.src=SONGLIST[c].songLink,b.src="http://mr4.douban.com/201406262313/095f9b4155226d0bcfb60cc64064e9d2/view/song/small/p17999_1v.mp4",b.play(),c++},!1)},window.onload=function(){var b=document.getElementsByTagName("audio")[0],c=document.getElementById("control-play"),d=document.getElementById("control-backward"),e=document.getElementById("control-forward"),f=document.getElementById("control-volume-down"),g=document.getElementById("control-volume-up"),h=new a(b);h.addItem("audio",b),h.addItem("play",c),h.addItem("backward",d),h.addItem("forward",e),h.addItem("volumeDown",f),h.addItem("volumeUp",g),console.log(h),h.emitplay(),h.adjustVolume(),h.next()}}();var mplayers={ajax:{getRequest:null}},CONFIG={url:{users:"http://fm.baidu.com/dev/api/?tn=usercounts&_=1403397847605",postUrl:"http://fm.baidu.com/dev/api/?action=userop&tn=userop&_=",playlist:"http://fm.baidu.com/dev/api/?tn=playlist&id=public_yuzhong_huayu&special=flash&prepend=&format=json&_=1403362900890",songlink:"http://music.baidu.com/data/music/fmlink?type=mp3&rate=128&callback=jsonpGetSongList&songIds="}};mplayers.ajax.getRequest=function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&200==c.status&&b(c.responseText)},c.open("GET",a,!1),c.send(null)},mplayers.ajax.postRequest=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&200==d.status&&c(d.responseText)},d.open("POST",a,!1),d.setRequestHeader("Content-Type","applicaiotn/x-www-form-urlencoded"),d.send(b)},mplayers.addScript=function(a,b){var c=document.createElement("script"),d=document.getElementsByTagName("head")[0];c.onload=function(){b()},d.appendChild(c),c.src=a},mplayers.getTime=function(){var a=new Date;return a.getTime()},mplayers.ajax.getRequest("php/proxy.php?url="+CONFIG.url.playlist,function(a){console.log("playlist callback"),a=JSON.parse(a);for(var b=a.list,c=b.length-1;c>=0;c--)SONGIDS.push(b[c].id);console.log(SONGIDS)}),CONFIG.url.songlink+=SONGIDS.join(","),CONFIG.url.songlink+="&_="+mplayers.getTime(),mplayers.addScript(CONFIG.url.songlink,function(){console.log("jsonp 调用成功！！！！")});